{% extends 'base.html' %}
{% load static %}
{% block content %}
    <div class="container my-5">
        <h1 class="text-center text-black mb-4">Consultas Diarias</h1>
        
        <div class="table-responsive shadow-sm p-3 mb-5 bg-body rounded">
            <table id="consultas-table" class="table table-hover table-bordered table-striped align-middle">
                <thead class="table-primary text-center">
                    <tr>
                        <th>Nombre Cliente</th>
                        <th>Teléfono</th>
                        <th>Tipo de Consulta</th>
                        <th>Problema del Cliente</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for consulta in consultas %}
                        <tr id="consulta-{{ consulta.airtable_id }}">
                            <td class="text-center">{{ consulta.fields.Cliente }}</td>
                            <td class="text-center">{{ consulta.fields.Telefono }}</td>
                            <td class="text-center">
                                <span class="badge {% if consulta.fields.TipoConsulta == 'Urgencia' %}bg-danger{% elif consulta.fields.TipoConsulta == 'Presupuesto' %}bg-primary{% else %}bg-warning text-dark{% endif %}">
                                    {{ consulta.fields.TipoConsulta }}
                                </span>
                            </td>
                            <td>{{ consulta.fields.DescripcionConsulta }}</td>
                            <td class="text-center">
                                <!-- Select para cambiar el estado -->
                                <form 
                                     hx-trigger="change" hx-target="closest tr" hx-swap="outerHTML">
                                    {% csrf_token %}
                                    <select name="Estado" class="form-select estado-select">
                                        <option value="Pendiente" {% if consulta.fields.Estado == "Pendiente" %}selected{% endif %}>Pendiente</option>
                                        <option value="En proceso" {% if consulta.fields.Estado == "En proceso" %}selected{% endif %}>En proceso</option>
                                        <option value="Finalizado" {% if consulta.fields.Estado == "Finalizado" %}selected{% endif %}>Finalizado</option>
                                    </select>
                                </form>
                            </td>
                            <td class="text-center">
                                <!-- Botón para eliminar la consulta -->
                                <form class="delete-form"  hx-confirm="¿Estás seguro de que deseas eliminar esta consulta?" hx-target="closest tr" hx-swap="outerHTML">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-info btn-md mx-1" title="Editar campo">
                                        <i class="fa-solid fa-rotate"></i> <!-- Icono de eliminación -->
                                    </button>
                                    <button type="submit" class="btn btn-danger btn-md mx-1" title="Eliminar Consulta">
                                        <i class="fa-solid fa-circle-minus"></i> <!-- Icono de eliminación -->
                                    </button>
                                    
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
